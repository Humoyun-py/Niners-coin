<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Detailed Analytics | Niners.uz</title>
    <link rel="stylesheet" href="../../styles/main.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="dashboard-grid">
        <div id="sidebarContainer"></div>
        <main class="main-content">
            <h2>Kengaytirilgan Analitika</h2>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:30px; margin-top:30px;">
                <div class="card" style="background:white; padding:24px; border-radius:12px;">
                    <h3>Sinfxonalar faolligi (Reyting)</h3>
                    <canvas id="classActivityChart"></canvas>
                </div>
                <div class="card" style="background:white; padding:24px; border-radius:12px;">
                    <h3>Oylik Coin aylanishi</h3>
                    <canvas id="coinCirkulationChart"></canvas>
                </div>
            </div>
        </main>
    </div>
    <script src="../../js/api.js"></script>
    <script src="../../js/sidebar-loader.js"></script>
    <script>
        async function loadCharts() {
            try {
                const data = await api.get('/director/analytics');

                // 1. Class Activity Chart
                const classCtx = document.getElementById('classActivityChart');
                new Chart(classCtx, {
                    type: 'polarArea',
                    data: {
                        labels: data.class_activity.map(a => a.name),
                        datasets: [{
                            data: data.class_activity.map(a => a.value),
                            backgroundColor: ['#6C5CE7', '#00B894', '#FDCB6E', '#FF7675', '#0984E3']
                        }]
                    },
                    options: { responsive: true }
                });

                // 2. Coin Circulation Chart
                const coinCtx = document.getElementById('coinCirkulationChart');
                new Chart(coinCtx, {
                    type: 'line',
                    data: {
                        labels: data.circulation.map(c => c.date),
                        datasets: [{
                            label: 'Coins Issued',
                            data: data.circulation.map(c => c.value),
                            borderColor: '#FDCB6E',
                            backgroundColor: 'rgba(253, 203, 110, 0.2)',
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: { responsive: true }
                });

            } catch (e) {
                console.error("Analitika yuklashda xatolik:", e);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadCharts();
        });
    </script>
</body>

</html>